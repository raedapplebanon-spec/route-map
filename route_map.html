<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Route Map</title>

  <link rel="stylesheet" href="https://raedapplebanon-spec.github.io/route-map/style.css?v=3" />
  
  <style>
    /* Your CSS remains exactly as you wrote it */
    #map { height: 100vh; width: 100%; } /* Ensure map has height! */
    #pac-input { ... }
    .route-summary { ... }
    .hidden { display: none; }
    /* ... rest of your styles ... */
  </style>
</head>

<body>
  <input id="pac-input" class="controls" type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù†ÙˆØ§Ù† Ø£Ùˆ Ø§Ø³Ù… Ø·Ø§Ù„Ø¨...">
  
  <div id="map"></div>

  <div class="legend">...</div>
  <div id="route-summary" class="route-summary hidden">
    <h3 style="margin:0; font-size:15px;">ğŸ“ Ù…Ù„Ø®Øµ Ø§Ù„Ø¬ÙˆÙ„Ø©</h3>
    <div id="summary-text">â€”</div>
  </div>

  <script src="https://raedapplebanon-spec.github.io/route-map/map_script.js?v=6"></script>

  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCYaJ4Gjq36mq8swYgjNXOYr5mKZi45niA&callback=initMap&libraries=marker,places&v=beta"
    async defer>
  </script>

  <script>
    // Store data if the script isn't ready yet
    let pendingData = null;

    window.addEventListener("message", function (event) {
      // Security: Optional check for FlutterFlow domain
      if (!event.data || event.data.action !== "setRouteData") return;

      const routeData = event.data.routeData || [];
      const availableData = event.data.availableData || [];
      
      console.log("ğŸ“© Received from Flutter:", routeData, availableData);

      if (window.setRouteData) {
        window.setRouteData(routeData, availableData);
      } else {
        console.warn("âš ï¸ setRouteData() not ready yet. Saving data for later.");
        pendingData = { routeData, availableData };
      }
    });

    // Check every 500ms if the map script has loaded, then push pending data
    const checkReady = setInterval(() => {
      if (window.setRouteData && pendingData) {
        window.setRouteData(pendingData.routeData, pendingData.availableData);
        pendingData = null;
        clearInterval(checkReady);
      }
    }, 500);
  </script>
</body>
</html>
